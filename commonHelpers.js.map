{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport const pixabayApi = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  params: {\n    key: '33901204-9e2cee760dcc4c2bf1fca35a0',\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 20,\n  },\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\nexport async function getPhotos({ searchValue = '', page = 1, signal }) {\n  validateSearchValue(searchValue);\n\n  const { data } = await pixabayApi.get('', {\n    params: {\n      q: searchValue,\n      page,\n    },\n    signal,\n  });\n\n  return data;\n}\n\nfunction validateSearchValue(searchValue) {\n  if (searchValue.length > 100) {\n    const message = 'Search value may not exceed 100 characters.';\n    throw new Error(message);\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nexport const galleryRef = document.getElementById('gallery');\n\nconst gallerySimpleLightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n  overlayOpacity: 0.8,\n});\n\nexport const gallery = {\n  addPhotos(data) {\n    const markup = data.map(this.generatePhotoMarkup).join('');\n    galleryRef.insertAdjacentHTML('beforeend', markup);\n    gallerySimpleLightbox.refresh();\n  },\n  clear() {\n    galleryRef.innerHTML = '';\n  },\n  generatePhotoMarkup({\n    largeImageURL,\n    tags,\n    webformatURL,\n    likes,\n    views,\n    comments,\n    downloads,\n  }) {\n    return `\n        <li class=\"gallery-item\">\n            <a class=\"gallery-link\" href=\"${largeImageURL}\">\n                <img\n                  class=\"gallery-image\"\n                  loading=\"lazy\"\n                  src=\"${webformatURL}\"\n                  alt=\"${tags}\"\n                />\n                <span class=\"gallery-info-bar\">\n                    <span class=\"gallery-info\">\n                        <span class=\"gallery-info-label\">Likes</span>\n                        <span class=\"gallery-info-value\">${likes}</span>\n                    </span>\n                    <span class=\"gallery-info\">\n                        <span class=\"gallery-info-label\">Views</span>\n                        <span class=\"gallery-info-value\">${views}</span>\n                    </span>\n                    <span class=\"gallery-info\">\n                        <span class=\"gallery-info-label\">Comments</span>\n                        <span class=\"gallery-info-value\">${comments}</span>\n                    </span>\n                    <span class=\"gallery-info\">\n                        <span class=\"gallery-info-label\">Downloads</span>\n                        <span class=\"gallery-info-value\">${downloads}</span>\n                    </span>\n                </span>\n            </a>\n        </li>\n    `;\n  },\n};\n\nexport const progressElement = {\n  ref: document.querySelector('.progress-bar'),\n  hide() {\n    this.ref.classList.remove('progress-bar--show');\n  },\n  show() {\n    this.ref.classList.add('progress-bar--show');\n  },\n};\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport { getPhotos } from './js/pixabay-api';\nimport { galleryRef, gallery, progressElement } from './js/render-functions';\nimport { isAxiosError } from 'axios';\n\nconst notify = {\n  success(message) {\n    iziToast.success({\n      position: 'topRight',\n      message,\n    });\n  },\n  error(message) {\n    iziToast.error({\n      position: 'topRight',\n      message,\n    });\n  },\n};\n\nconst sentinelRef = document.querySelector('.sentinel');\nconst formRef = document.querySelector('.search-form');\nconst buttonElement = {\n  ref: formRef.querySelector('.button'),\n  disabled: false,\n  disable() {\n    this.disabled = true;\n    this.ref.setAttribute('disabled', '');\n  },\n  enable() {\n    this.disabled = false;\n    this.ref.removeAttribute('disabled');\n  },\n};\n\nformRef.addEventListener('submit', handleSearchPhotos);\n\nlet searchValue = '';\n\nasync function handleSearchPhotos(e) {\n  e.preventDefault();\n  if (buttonElement.disabled) return;\n\n  try {\n    buttonElement.disable();\n    disconnectIntersectionObserver();\n    gallery.clear();\n    progressElement.show();\n\n    searchValue = e.target.elements['search-value']?.value ?? '';\n\n    const data = await getPhotos({\n      searchValue: searchValue.trim(),\n    });\n\n    if (!data.hits?.length) {\n      notify.error(\n        'Sorry, there are no images matching your search query. Please try again!'\n      );\n    }\n\n    gallery.addPhotos(data.hits ?? []);\n\n    if (data.hits?.length) {\n      registerIntersectionObserver();\n    }\n  } catch (error) {\n    notify.error(err?.message ?? 'Something went wrong');\n  } finally {\n    buttonElement.enable();\n    progressElement.hide();\n  }\n}\n\nlet abortController = null;\nlet observer = null;\nlet page = 1;\n\nfunction registerIntersectionObserver() {\n  abortController = new AbortController();\n  const options = {\n    rootMargin: '800px',\n  };\n\n  const onEntry = entries => {\n    entries.forEach(async entry => {\n      if (entry.isIntersecting) {\n        try {\n          progressElement.show();\n          page += 1;\n\n          const data = await getPhotos({\n            page,\n            searchValue,\n            signal: abortController.signal,\n          });\n          gallery.addPhotos(data.hits ?? []);\n          checkCollectionEnd(data.totalHits);\n        } catch (error) {\n          if (isAxiosError(error) && error.code === 'ERR_CANCELED') {\n            return;\n          }\n          notify.error(error.message);\n        } finally {\n          progressElement.hide();\n        }\n      }\n    });\n  };\n\n  observer = new IntersectionObserver(onEntry, options);\n  observer.observe(sentinelRef);\n}\n\nfunction disconnectIntersectionObserver() {\n  page = 1;\n  if (abortController) {\n    abortController.abort();\n  }\n  if (observer) {\n    observer.disconnect();\n  }\n}\n\nfunction checkCollectionEnd(totalHits) {\n  if (totalHits <= galleryRef.children.length) {\n    notify.success(\n      \"We're sorry, but you've reached the end of search results.\"\n    );\n\n    disconnectIntersectionObserver();\n  }\n}\n"],"names":["pixabayApi","axios","getPhotos","searchValue","page","signal","validateSearchValue","data","message","galleryRef","gallerySimpleLightbox","SimpleLightbox","gallery","markup","largeImageURL","tags","webformatURL","likes","views","comments","downloads","progressElement","notify","iziToast","sentinelRef","formRef","buttonElement","handleSearchPhotos","e","disconnectIntersectionObserver","_a","_b","_c","registerIntersectionObserver","abortController","observer","options","onEntry","entries","entry","checkCollectionEnd","error","isAxiosError","totalHits"],"mappings":"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"}